{% extends 'base.html' %}
{% load static %}
{% block content %}

<style>
    /* ‚îÄ‚îÄ CATEGORY HERO BANNER ‚îÄ‚îÄ */
    .cat-hero {
        position: relative;
        background: var(--ink);
        border-radius: 14px;
        padding: 2.2rem 2.8rem;
        margin-bottom: 2.5rem;
        overflow: hidden;
    }
    .cat-hero::before {
        content: '';
        position: absolute;
        inset: 0;
        background: radial-gradient(ellipse at 80% 50%, rgba(200,150,62,0.25) 0%, transparent 65%);
    }
    .cat-hero-label {
        font-size: 0.7rem;
        font-weight: 500;
        letter-spacing: 0.2em;
        text-transform: uppercase;
        color: var(--accent);
        margin-bottom: 0.5rem;
    }
    .cat-hero-title {
        font-family: 'Cormorant Garamond', serif;
        font-size: clamp(1.8rem, 5vw, 3rem);
        font-weight: 700;
        color: #fff;
        line-height: 1.1;
        letter-spacing: -1px;
        position: relative;
    }
    .cat-hero-count {
        margin-top: 0.6rem;
        font-size: 0.82rem;
        color: rgba(255,255,255,0.45);
        position: relative;
    }
    .cat-hero-bg-text {
        position: absolute;
        right: 2rem;
        top: 50%;
        transform: translateY(-50%);
        font-family: 'Cormorant Garamond', serif;
        font-size: 10rem;
        font-weight: 700;
        color: rgba(255,255,255,0.04);
        line-height: 1;
        pointer-events: none;
        user-select: none;
    }

    /* ‚îÄ‚îÄ GRID ‚îÄ‚îÄ */
    .posts-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 1rem;
    }

    /* Every 4th card-wrap spans 2 cols */
    .posts-grid .post-card-wrap:nth-child(4n+1) {
        grid-column: span 2;
    }
    .posts-grid .post-card-wrap:nth-child(4n+1) .post-card {
        aspect-ratio: 16/9;
    }
    .posts-grid .post-card-wrap:nth-child(4n+1) .card-title {
        font-size: 1.35rem;
    }

    /* ‚îÄ‚îÄ CARD WRAP ‚îÄ‚îÄ */
    .post-card-wrap {
        display: block;
        position: relative;
    }

    /* ‚îÄ‚îÄ INSTAGRAM CARD ‚îÄ‚îÄ */
    .post-card {
        position: relative;
        border-radius: 11px;
        overflow: hidden;
        cursor: pointer;
        display: block;
        text-decoration: none;
        color: inherit;
        background: #1a2a3a;
        aspect-ratio: 4/5;
        box-shadow: 0 4px 18px rgba(0,0,0,0.13);
        transition: transform 0.35s cubic-bezier(0.25,0.8,0.25,1), box-shadow 0.35s;
    }
    .post-card:hover {
        transform: translateY(-5px) scale(1.01);
        box-shadow: 0 14px 40px rgba(0,0,0,0.22);
    }

    .post-card .card-bg {
        position: absolute;
        inset: 0;
        background-size: cover;
        background-position: center;
        transition: transform 0.55s ease;
    }
    .post-card:hover .card-bg { transform: scale(1.06); }

    .post-card .card-overlay {
        position: absolute;
        inset: 0;
        background: linear-gradient(to top, rgba(0,0,0,0.88) 0%, rgba(0,0,0,0.3) 50%, rgba(0,0,0,0.05) 100%);
        transition: background 0.3s;
    }
    .post-card:hover .card-overlay {
        background: linear-gradient(to top, rgba(0,0,0,0.92) 0%, rgba(0,0,0,0.5) 60%, rgba(0,0,0,0.1) 100%);
    }

    /* card-body gets bottom padding to clear the like bar */
    .post-card .card-body {
        position: absolute;
        bottom: 0; left: 0; right: 0;
        padding: 1rem 1.1rem 3.4rem;
        z-index: 2;
    }
    .post-card .card-meta {
        font-size: 0.68rem;
        color: rgba(255,255,255,0.55);
        margin-bottom: 0.4rem;
    }
    .post-card .card-title {
        font-family: 'Cormorant Garamond', serif;
        font-size: 1.05rem;
        font-weight: 600;
        color: #fff;
        line-height: 1.3;
        margin-bottom: 0.4rem;
    }
    .post-card .card-desc {
        font-size: 0.78rem;
        color: rgba(255,255,255,0.72);
        line-height: 1.5;
        max-height: 0;
        overflow: hidden;
        opacity: 0;
        transition: max-height 0.4s ease, opacity 0.3s;
    }
    .post-card:hover .card-desc { max-height: 70px; opacity: 1; }

    .post-card .card-read {
        display: inline-flex;
        align-items: center;
        gap: 0.4rem;
        font-size: 0.7rem;
        font-weight: 500;
        color: var(--accent);
        margin-top: 0.5rem;
        opacity: 0;
        transform: translateY(4px);
        transition: all 0.3s 0.1s;
    }
    .post-card:hover .card-read { opacity: 1; transform: translateY(0); }

    /* ‚îÄ‚îÄ LIKE BAR ‚Äî pinned inside card at the bottom ‚îÄ‚îÄ */
    .card-like-bar {
        position: absolute;
        bottom: 0; left: 0; right: 0;
        z-index: 10;
        padding: 0.5rem 1rem;
        display: flex;
        align-items: center;
        justify-content: space-between;
        background: rgba(0,0,0,0.48);
        backdrop-filter: blur(8px);
        -webkit-backdrop-filter: blur(8px);
        border-top: 1px solid rgba(255,255,255,0.08);
    }

    .card-like-bar form {
        display: flex;
        align-items: center;
        margin: 0;
        padding: 0;
    }

    /* stop the form click from navigating the <a> */
    .card-like-bar form,
    .card-like-bar button {
        position: relative;
        z-index: 11;
    }

    .like-btn {
        display: inline-flex;
        align-items: center;
        gap: 0.3rem;
        background: none;
        border: 1.5px solid rgba(255,255,255,0.18);
        cursor: pointer;
        padding: 0.22rem 0.65rem;
        border-radius: 50px;
        font-size: 0.7rem;
        font-weight: 600;
        letter-spacing: 0.04em;
        text-transform: uppercase;
        transition: background 0.2s, border-color 0.2s, transform 0.15s, color 0.2s;
        color: rgba(255,255,255,0.8);
        line-height: 1;
    }
    .like-btn i { font-size: 0.75rem; }

    /* Vote (not yet liked) */
    .like-btn.vote {
        border-color: rgba(255,255,255,0.2);
        color: rgba(255,255,255,0.8);
    }
    .like-btn.vote:hover {
        background: rgba(99,205,132,0.22);
        border-color: #63cd84;
        color: #63cd84;
        transform: scale(1.06);
    }

    /* Rethink (already liked) */
    .like-btn.rethink {
        border-color: rgba(255,100,100,0.45);
        color: #ff8080;
        background: rgba(255,80,80,0.1);
    }
    .like-btn.rethink:hover {
        background: rgba(255,80,80,0.25);
        border-color: #ff6060;
        transform: scale(1.06);
    }

    .like-count {
        font-size: 0.7rem;
        color: rgba(255,255,255,0.65);
        font-weight: 500;
        display: flex;
        align-items: center;
        gap: 4px;
    }
    .like-count i { color: #ff7070; font-size: 0.62rem; }

    /* fallback bg colors */
    .post-card[data-index="0"] .card-bg { background-color: #1a3040; }
    .post-card[data-index="1"] .card-bg { background-color: #2d1f3d; }
    .post-card[data-index="2"] .card-bg { background-color: #0f2b1e; }
    .post-card[data-index="3"] .card-bg { background-color: #3d1f1f; }
    .post-card[data-index="4"] .card-bg { background-color: #1f2d3d; }
    .post-card[data-index="5"] .card-bg { background-color: #2a2a1a; }

    /* ‚îÄ‚îÄ EMPTY STATE ‚îÄ‚îÄ */
    .empty-state {
        grid-column: 1 / -1;
        text-align: center;
        padding: 5rem 2rem;
        color: var(--muted);
    }
    .empty-state .empty-icon { font-size: 3rem; margin-bottom: 1rem; opacity: 0.2; }
    .empty-state h3 {
        font-family: 'Cormorant Garamond', serif;
        font-size: 1.5rem;
        color: var(--ink);
        margin-bottom: 0.5rem;
    }
    .empty-state p { font-size: 0.88rem; }
    .empty-state a {
        display: inline-block;
        margin-top: 1.2rem;
        background: var(--ink);
        color: #fff;
        padding: 0.55rem 1.5rem;
        border-radius: 50px;
        text-decoration: none;
        font-size: 0.82rem;
        transition: background 0.2s;
    }
    .empty-state a:hover { background: var(--accent); }

    @media (max-width: 900px) {
        .posts-grid { grid-template-columns: repeat(2, 1fr); }
        .posts-grid .post-card-wrap:nth-child(4n+1) { grid-column: 1 / -1; }
    }
    @media (max-width: 560px) {
        .posts-grid { grid-template-columns: 1fr; }
        .posts-grid .post-card-wrap:nth-child(4n+1) { grid-column: 1; }
        .cat-hero { padding: 1.5rem; }
    }
</style>


<!-- ‚îÄ‚îÄ CATEGORY HERO ‚îÄ‚îÄ -->
<div class="cat-hero">
    <p class="cat-hero-label">Browsing category</p>
    <h1 class="cat-hero-title">{{ category }}</h1>
    <p class="cat-hero-count">
        {% if posts %}{{ posts|length }} article{{ posts|length|pluralize }} found{% endif %}
    </p>
    <span class="cat-hero-bg-text">{{ category }}</span>
</div>


<!-- ‚îÄ‚îÄ POSTS GRID ‚îÄ‚îÄ -->
<div class="posts-grid">
    {% if posts %}
        {% for post in posts %}

        <div class="post-card-wrap">
            <a class="post-card" href="{% url 'blogs' post.slug %}" data-index="{{ forloop.counter0 }}">
                <div class="card-bg"
                     {% if post.featured_image %}style="background-image: url('{{ post.featured_image.url }}')"{% endif %}>
                </div>
                <div class="card-overlay"></div>
                <div class="card-body">
                    <p class="card-meta">
                        <i class="far fa-clock"></i> {{ post.created_at|timesince }} ago &nbsp;¬∑&nbsp; {{ post.author }}
                    </p>
                    <h3 class="card-title">{{ post.title }}</h3>
                    <p class="card-desc">{{ post.short_description|truncatewords:18 }}</p>
                    <span class="card-read">Read article <i class="fas fa-arrow-right" style="font-size:0.65rem"></i></span>
                </div>

                <!-- ‚ù§Ô∏è Like bar ‚Äî inside the card, pinned to bottom -->
                <div class="card-like-bar">
                    <form action="{% url 'complains:like_post' %}" method="POST">
                        {% csrf_token %}
                        <input type="hidden" name="post_id" value="{{ post.id }}">
                        {% if user not in post.liked.all %}
                            <button class="like-btn vote" type="submit">
                                <i class="far fa-heart"></i> Vote
                            </button>
                        {% else %}
                            <button class="like-btn rethink" type="submit">
                                <i class="fas fa-heart"></i> Thanks
                            </button>
                        {% endif %}
                    </form>
                    <span class="like-count">
                        <i class="fas fa-heart"></i> {{ post.liked.all.count }}
                    </span>
                </div>

            </a>
        </div>

        {% endfor %}

    {% else %}
        <div class="empty-state">
            <div class="empty-icon">üì≠</div>
            <h3>No posts found</h3>
            <p>There are no articles in this category yet. Check back soon!</p>
            <a href="{% url 'home' %}">‚Üê Back to Home</a>
        </div>
    {% endif %}
</div>

{% endblock %}